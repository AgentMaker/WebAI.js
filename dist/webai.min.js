(()=>{var e={511:e=>{class t{static async create(e,t={logSeverityLevel:4},s=null,i=null,r=null){let o=new this;return o.session=await l.ort.InferenceSession.create(e,t),s&&s(o),i&&(o.preProcess=i),r&&(o.postProcess=r),o}async infer(...e){console.time("Infer"),console.time("Infer.Preprocess");let t=this.preProcess(...e);console.timeEnd("Infer.Preprocess"),console.time("Infer.Run");let s=await this.session.run(t);console.timeEnd("Infer.Run"),console.time("Infer.Postprocess");let i=this.postProcess(s,...e);return console.timeEnd("Infer.Postprocess"),console.timeEnd("Infer"),i}}class s extends t{static async create(e,t,s={logSeverityLevel:4},i=null,r=null){let o=await super.create(e,s,null,null,r);return o.loadConfigs(t),i&&(o.getFeeds=i),o}loadConfigs(e){let t=JSON.parse(l.loadText(e)),s=t.Preprocess;this.isPermute=!1,this.isCrop=!1,this.isResize=!1;for(let e=0;e<s.length;e++){let t=s[e];if("Decode"==t.type){if(this.mode=t.mode,"RGB"!=this.mode&&"BGR"!=this.mode)throw`Not support ${t.mode} mode.`}else if("Resize"==t.type)this.isResize=!0,this.interp=t.interp,this.keepRatio=t.keep_ratio,this.targetSize=t.target_size,this.limitMax=t.limit_max;else if("Normalize"==t.type)this.isScale=t.is_scale,this.isScale&&(this.scale=[255,255,255,0]),this.mean=t.mean,this.mean.push(0),this.std=t.std,this.std.push(0);else if("Crop"==t.type)this.isCrop=!0,this.cropSize=t.crop_size;else{if("Permute"!=t.type)throw`Not support ${t.type} OP.`;this.isPermute=!0}}t.hasOwnProperty("label_list")?(this.labelList=t.label_list,this.colorMap=l.getColorMap(this.labelList)):this.labelList=null,console.info("model info: ",{mode:this.mode,isResize:this.isResize,interp:this.interp,keepRatio:this.keepRatio,targetSize:this.targetSize,isScale:this.isScale,limitMax:this.limitMax,mean:this.mean.slice(0,3),std:this.std.slice(0,3),isCrop:this.isCrop,cropSize:this.cropSize,isPermute:this.isPermute,labelList:this.labelList})}preProcess(...e){let t,s,i,r,[o,a,n]=e.slice(0,3);if(this.isResize?[t,s,i]=l.resize(o,a,n,this.targetSize,this.keepRatio,this.limitMax,this.interp):t=o.clone(),this.isCrop){let e=l.crop(t,this.cropSize);"RGB"==this.mode?r=l.rgba2rgb(e):"BGR"==this.mode&&(r=l.rgba2bgr(e)),e.delete()}else"RGB"==this.mode?r=l.rgba2rgb(t):"BGR"==this.mode&&(r=l.rgba2bgr(t)),t.delete();let c,h=l.normalize(r,this.scale,this.mean,this.std,this.isScale),[p,d]=[h.rows,h.cols];return this.isPermute?c=new l.ort.Tensor("float32",l.permute(h),[1,3,p,d]):(c=new l.ort.Tensor("float32",h.data32F,[1,p,d,3]),h.delete()),this.getFeeds(c,s,i)}}class i extends s{getFeeds(e,t,s){let i=this.session.inputNames,r={im_shape:new l.ort.Tensor("float32",Float32Array.from(e.dims.slice(2,4)),[1,2]),image:e,scale_factor:new l.ort.Tensor("float32",Float32Array.from([s,t]),[1,2])},o={};for(let e=0;e<i.length;e++)o[i[e]]=r[i[e]];return o}postProcess(e,...t){let[s,i,r]=t.slice(1,4),o=Object.values(e)[0],l=[],a=o.dims[0],n=o.data;for(let e=0;e<a;e++){let t=n[6*e+0],o=n[6*e+1],a=Math.max(0,Math.round(n[6*e+2])),c=Math.max(0,Math.round(n[6*e+3])),h=Math.min(i,Math.round(n[6*e+4])),p=Math.min(s,Math.round(n[6*e+5])),d=this.labelList[t],u=this.colorMap[t].color;if(o>r){let e={label:d,color:u,score:o,x1:a,y1:c,x2:h,y2:p};l.push(e)}}return l}async infer(e,t=.5){return super.infer(e,e.rows,e.cols,t)}}class r extends s{getFeeds(e){return{x:e}}postProcess(e,...t){let s=t[3],i=Object.values(e)[0].data,r=[];for(let e=0;e<this.labelList.length;e++)r.push({label:this.labelList[e],prob:i[e]});return s>0?r.sort(((e,t)=>t.prob-e.prob)).slice(0,s):r.sort(((e,t)=>t.prob-e.prob))}async infer(e,t=5){return super.infer(e,e.rows,e.cols,t)}}class o extends s{getFeeds(e){return{x:e}}postProcess(e){let t=Object.values(e)[0],s=t.data,[i,r,o,a]=t.dims,n=o*a,c=[];for(let e=0;e<r;e++)c.push(s.slice(e*n,(e+1)*n));let h,p,d=[],u=[];for(let e=0;e<n;e++){h=[];for(let t=0;t<r;t++)h.push(c[t][e]);p=l.argMax(h),u.push(p),d.push(...this.colorMap[p].color)}return{argMax:u,colorMapping:d,colorMap:this.colorMap}}infer(e){return super.infer(e,e.rows,e.cols)}}class l{static argMax(e){let t=Math.max.apply(null,e);return e.findIndex((function(e){return e==t}))}static getIMScale(e,t,s,i,r){let o,l;if(i){let i=Math.min(e,t),a=Math.min(s[0],s[1])/i;if(r){let i=Math.max(e,t),r=Math.max(s[0],s[1]);Math.round(a*i)>r&&(a=r/i)}o=a,l=a}else l=s[0]/e,o=s[1]/t;return[o,l]}static rgba2rgb(e){let t=new this.cv.Mat;return this.cv.cvtColor(e,t,this.cv.COLOR_RGBA2RGB),t}static rgba2bgr(e){let t=new this.cv.Mat;return this.cv.cvtColor(e,t,this.cv.COLOR_RGBA2BGR),t}static resize(e,t,s,i,r,o,l){let[a,n]=this.getIMScale(t,s,i,r,o),c=new this.cv.Mat;return this.cv.resize(e,c,{width:0,height:0},a,n,l),[c,a,n]}static crop(e,t){let s=e.roi({x:Math.ceil((e.cols-t[1])/2),y:Math.ceil((e.rows-t[0])/2),width:t[1],height:t[0]});return e.delete(),s}static normalize(e,t,s,i,r){if(e.convertTo(e,this.cv.CV_32F),r){let s=new this.cv.Mat(e.rows,e.cols,this.cv.CV_32FC3,t);this.cv.divide(e,s,e),s.delete()}let o=new this.cv.Mat(e.rows,e.cols,this.cv.CV_32FC3,s);this.cv.subtract(e,o,e),o.delete();let l=new this.cv.Mat(e.rows,e.cols,this.cv.CV_32FC3,i);return this.cv.divide(e,l,e),l.delete(),e}static permute(e){let t=new this.cv.MatVector;this.cv.split(e,t);let s=t.get(0),i=t.get(1),r=t.get(2);t.delete();let o=new Float32Array(3*s.data32F.length);return o.set(s.data32F,0),o.set(i.data32F,s.data32F.length),o.set(r.data32F,2*s.data32F.length),s.delete(),i.delete(),r.delete(),e.delete(),o}static loadText(e){let t=new XMLHttpRequest;return t.open("get",e,!1),t.send(null),t.responseText}static getColorMap(e){let t=e.length,s=[],i=Math.ceil(16777216/t);for(let r=0;r<t;r++){let t=(i*r).toString(16),o=[];for(let e=0;e<6;e+=2){let s=t.slice(e,e+2);""==s?o.push(0):o.push(parseInt("0x"+s))}o.push(255),s.push({label:e[r],color:o})}return s}static drawBBoxes(e,t,s=!0,i=!0,r=2,o=8,l=0,a=.7){let n=e.clone();for(let e=0;e<t.length;e++){let c=t[e];this.cv.rectangle(n,{x:c.x1,y:c.y1},{x:c.x2,y:c.y2},c.color,r,o),s&&i?this.cv.putText(n,`${c.label} ${(100*c.score).toFixed(2)}%`,{x:c.x1,y:c.y2},l,a,c.color,r,o):s?this.cv.putText(n,`${c.label}`,{x:c.x1,y:c.y2},l,a,c.color,r,o):i&&this.cv.putText(n,`${(100*c.score).toFixed(2)}%`,{x:c.x1,y:c.y2},l,a,c.color,r,o)}return n}static Model=t;static CV=s;static Det=i;static Cls=r;static Seg=o}e.exports=l}},t={};function s(i){var r=t[i];if(void 0!==r)return r.exports;var o=t[i]={exports:{}};return e[i](o,o.exports,s),o.exports}(()=>{function e(e,t){let s=document.createElement("script");return s.setAttribute("type","text/javascript"),s.setAttribute("src",e),s.setAttribute("onload",t),document.getElementsByTagName("head")[0].appendChild(s),s}window.WebAI=s(511),window.onLoadONNX=function(){console.info("ONNXRuntime-web has been loaded."),window.WebAI.ort=window.ort},window.onLoadOpenCV=function(){console.info("OpenCV.js has been loaded."),window.WebAI.cv=window.cv},e("https://cdn.jsdelivr.net/npm/onnxruntime-web@1.10.0/dist/ort.wasm.min.js","onLoadONNX()"),e("https://docs.opencv.org/4.5.5/opencv.js","onLoadOpenCV()"),console.info("WebAI.js has been loaded.")})()})();